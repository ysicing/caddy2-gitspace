# Caddy v2 K8s 动态路由配置示例

{
	# Admin API 配置（用于动态路由管理）
	admin localhost:2019

	# 关闭配置持久化（由 k8s_router 插件动态管理）
	persist_config off

	# 可选：配置日志级别
	# debug
}

# HTTP 服务（监听 80 端口）
:80 {
	# K8s 路由插件配置
	k8s_router {
		# 必需：监听的 Kubernetes 命名空间
		namespace default

		# 必需：基础域名（所有 Deployment 将使用 <deployment-name>.<base_domain>）
		base_domain example.com

		# 可选：默认端口（当 Deployment 没有 gitspace.caddy.default.port 注解时使用）
		default_port 8089

		# 可选：Kubeconfig 路径（默认使用 in-cluster 配置或 ~/.kube/config）
		# kubeconfig /path/to/kubeconfig

		# 可选：Informer 重新同步周期（默认 30s）
		# resync_period 30s

		# 可选：Caddy Admin API 地址（默认 http://localhost:2019）
		# caddy_admin_url http://localhost:2019

		# 可选：Caddy Server 名称（默认 srv0）
		# caddy_server_name srv0
	}

	# 可选：添加健康检查端点
	handle /healthz {
		respond "OK" 200
	}

	# 可选：添加默认响应（当没有匹配的路由时）
	handle {
		respond "No route found" 404
	}
}

# HTTPS 服务示例（监听 443 端口，自动 HTTPS）
# :443 {
# 	k8s_router {
# 		namespace default
# 		base_domain example.com
# 		default_port 8089
# 	}
#
# 	# Caddy 会自动处理 HTTPS 证书
# 	tls {
# 		# 使用 Let's Encrypt 自动签发证书
# 		# 或者指定证书文件
# 		# tls /path/to/cert.pem /path/to/key.pem
# 	}
# }

# 多命名空间示例（如果需要监听多个命名空间）
# :8080 {
# 	k8s_router {
# 		namespace dev
# 		base_domain dev.example.com
# 		default_port 8089
# 	}
# }
#
# :8081 {
# 	k8s_router {
# 		namespace prod
# 		base_domain prod.example.com
# 		default_port 8089
# 	}
# }
