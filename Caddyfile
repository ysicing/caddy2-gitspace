{
	admin localhost:2019

	# 阿里云 DNS API 配置
	acme_dns alidns {
		access_key_id {$ALICLOUD_ACCESS_KEY}
		access_key_secret {$ALICLOUD_SECRET_KEY}
	}

	# K8s Router 配置
	k8s_router {
		namespace {$K8S_NAMESPACE:default}
		base_domain {$BASE_DOMAIN:example.com}
		default_port {$DEFAULT_PORT:8089}
		# 注意: 插件只监控带有 gitspace.app.io/managed-by=caddy 标签的 Deployment
		# 这是硬编码的筛选规则，不可配置
	}
}

# HTTPS 通配符域名 - 只配置 TLS，路由由插件动态管理
*.{$BASE_DOMAIN:example.com} {
	tls {
		dns alidns {
			access_key_id {$ALICLOUD_ACCESS_KEY}
			access_key_secret {$ALICLOUD_SECRET_KEY}
		}
	}

	# 定义基础路由（healthz + catch-all）
	# 这些路由会自然排在最后，因为插件会在索引 0 插入具体路由
	# 最终顺序：
	# [0] specific-route-1.flow.biz     (插件通过 POST /routes/0 插入)
	# [1] specific-route-2.flow.biz     (插件通过 POST /routes/0 插入)
	# [2] *.flow.biz /healthz           (Caddyfile，自然排在后面)
	# [3] *.flow.biz catch-all 404      (Caddyfile，自然排在后面)

	handle /healthz {
		respond "OK" 200
	}

	handle {
		respond "Caddy K8s Router - No matching deployment" 404
	}
}
